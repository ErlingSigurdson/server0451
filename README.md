# Концепция
Простой TCP-сервер для Linux, который:
- по запросу клиента-подписчика (предполагается, что это будет устройство IoT, например, такое как [Билли](https://github.com/ErlingSigurdson/Billy_the_Relay)) направляет ему заготовленную команду на включение или выключение нагрузки.
- по команде клиента-постера (это может быть любое устройство, способное к коммуникации по TCP/IP) меняет заготовленную для клиента-подписчика команду.

Синтаксис запросов и команд подчиняется настройкам, заданным в настроечном файле (имя по умолчанию - `config_server0451`).
Администратор сервера может менять этот синтаксис по своему усмотрению путём редактирования настроечного файла.
Сервер может работать как в локальной сети, так и в глобальной - лишь бы был индивидуальный IP-адрес, по которому к серверу можно обратиться.

# Инструкция
### Компиляция
Зайдите в директорию `/server0451/src` и запустите команду `make`. Исполняемый файл программы появится в директории `/server0451/bin`.

### Запуск
Для запуска сервера запустите bash-скрипт `loop_script_server0451.sh`, файл с которым размещён в директории `/server0451/sh`. Файл должен быть исполняемым.
Скрипт запускает сразу два экземпляра программы, по умолчанию используя порты 80 и 451 - первый для отдачи команд серверу, второй для запросов управляемого устройства (клиента-подписчика).
При необходимости вы можете отредактировать скрипт, например, изменить номера портов или объём выводимой в консоль информации.
Если вы хотите, чтобы сервер продолжил работать после завершения вашей сессии работы с оболочкой операционной системы, рекомендуется запускать скрипт с помощью утилиты `nohup`.

Bash-скрипт `oneshot_script_server0451` работает аналогичным образом, но предназначен для отладки и знакомства с работой приложения. При его запуске сервер примет по одному сообщению
через каждый из двух указанных портов (сначала через первый, затем через второй).

Если разбираться более детально, то общий вид команды запуска приложения следующий:
```
sudo execute_server0451 -p <номер_порта> -f <путь_к_файлу_настроек> [-h][-v][-V] 
```

Описание необязательных опций:
- `-h` - выводит страницу с подсказками по использованию программы.
- `-v` - включает вывод в консоль информации о текущих действиях сервера, о принятых и переданных сообщениях.
- `-V` - делает вывод в консоль более подробным.

### Настроечный файл
У настроечного файла двойное назначение: он задаёт синтаксис команд и запросов, обрабатываемых сервером,
и хранит текущую команду, заготовленную для передачи клиенту-подписчику. предписываемое положение нагрузки, которое будет передаваться клиенту по его запросу.

Если по заданному в опции `-f` пути файл отсутствует, то программа создаст его, указав значения по умолчанию (см. файл `cmd.h`).
Он появится либо в директории, в которой находится исполняемый файл программы, либо в директории, в которой находится скрипт, запускающий исполняемый файл программы.

### Протоколы
Сервер принимает от клиента-постера как простые строки, направляемые по TCP без использования протоколов более высоких уровней OSI (например, с помощью `netcat`
или приложения для Android [Serial Wi-Fi terminal](https://serial-wifi-terminal.en.softonic.com/android)), так и HTTP-запросы. Приложение автоматически определит,
что поступивший пакет является HTTP-запросом, и выдаст соответствующий протоколу HTTP ответ.

Управлять сервером через HTTP можно методами GET (указывая соответствующий синтаксису команд URI) и POST (указывая в теле запроса соответствующую синтаксису
команд пару параметр+значение). Наконец, при большом желании вы можете вручную поменять в файле настроек текущее предписанное положение нагрузки. Клиент-подписчик получит ответ на свой запрос
исходя из нового содержимого файла.

### Управление несколькими устройствами
Никаких проблем, к серверу могут обращаться несколько устройств-подписчиков. Если все они должны получать одинаковую команду, то никаких дополнительных настроек
не нужно. Если есть два и более устройства, которые должны получать разные команды, то следует запустить соответствующее число экземпляров приложения, задав раздельные пути к файлам настроек,
и задать в файлах настроек хотя бы минимально различающийся синтаксис запросов и команд.

# Справедливые вопросы
### Почему "0451"?
[Отсылка](https://deusex.fandom.com/wiki/0451) к серии игр "Deus Ex".

### Зачем нужен скрипт оболочки? Нельзя ли было сделать так, чтобы программа продолжительно работала сам по себе?
Может, и можно, но с помощью команд оболочки проще удостовериться, что порт освободился после приёма или передачи очередного сообщения.

### Что с безопасностью?
Это не то ПО, которое предназначено для выполнения ответственных задач, но если вы зададите в файле настроек уникальный синтаксис запросов и команд, то вашим сервером хотя бы нельзя будет сходу начать управлять, направляя рандомные команды.

# Note for English speakers
Please note that `help page` is written in English. Run executable with `-h` option to read it or refer to [help_page.h](https://github.com/ErlingSigurdson/server0451/blob/main/src/help_page.h).
